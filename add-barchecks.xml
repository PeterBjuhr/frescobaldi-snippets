<?xml version='1.0' encoding='UTF-8'?>
<snippets>

<!--
  Created by Frescobaldi 2.18.1.
  
  Every snippet is represented by:
    title:      title text
    shortcuts:  list of shortcut elements, every shortcut is a key sequence
    body:       the snippet text
  
  The snippet id attribute can be the name of a builtin snippet or a random
  name like 'n123456'. In the latter case, the title is used to determine
  whether a snippet is new or updated.
-->

<snippet id="n394377">
<title>Add barchecks</title>
<shortcuts />
<body>-*- python;
# This snippet adds a barcheck on each newline 
# (if the line contains musicitems and not ends with a '{').

import lydocument
import ly.lex

def main():
    c = lydocument.cursor(cursor)
    source = lydocument.Source(c, True, tokens_with_position=True)
    in_music = False
    non_enders = (ly.lex.lilypond.SequentialStart)
    
    with c.document as d:
        for t in source:
            if isinstance(t, ly.lex.lilypond.MusicItem):
                in_music = True
            elif isinstance(t, non_enders):
                in_music = False             
            elif isinstance(t, ly.lex.Newline) and in_music:
                d[t.pos:t.pos] = " |"
                in_music = False
</body>
</snippet>

</snippets>
